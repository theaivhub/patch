(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"+Maf":function(e,t,a){"use strict";a.r(t);var s=a("8Y7J");class r{}var o=a("pMnS"),i=a("LvDl"),n=a("/FVO"),p=a("FARb"),l=a("vokB"),c=a("DA2H"),d=a("TrQs"),u=a("XNiG"),h=a("1G5W"),m=a("4QRW"),g=a("Vtdj");class f{constructor(e,t,a,s,r,o,i,n,p,l){this.router=e,this.activate=t,this.httpClient=a,this.cu=s,this.setLocal=r,this.setdataService=o,this.getdataservice=i,this.alert=n,this.adhocData=p,this.windowSizeChange=l,this.ngUnsubscribe=new u.a,this.reportParam={},this.outputType="rptdocument",this.console=!1}ngOnInit(){if("noparam"!==this.activate.snapshot.params.parameter){const e=this.activate.snapshot.params.parameter.split("&"),t={};i.forEach(e,(function(a,s){const r=a.split("___");t[r[0]]=r[1],s+1===e.length&&this.alert.setFilterFromOutside(t)}).bind(this))}if("internal"===this.activate.snapshot.params.embedType){const e=this.activate.snapshot.params.credential.split("&"),t={};let a="";i.forEach(e,(function(e){const s=e.split("__");"a_i"===s[0]&&""!==s[1]&&(t.fileid=s[1]),"a_n"===s[0]&&""!==s[1]&&(t.filename=s[1]),"a_af"===s[0]&&""!==s[1]&&localStorage.setItem("af",s[1]),"a_as"===s[0]&&""!==s[1]&&(a=s[1]),"a_ao"===s[0]&&""!==s[1]&&(t.owner=s[1]),"a_ex"===s[0]&&""!==s[1]&&(t.extra=s[1],this.outputType=s[1]),"a_tpr"===s[0]&&""!==s[1]&&(t.tpr=s[1]),"a_otr"===s[0]&&""!==s[1]&&(t.fType=s[1]),"a_con"===s[0]&&""!==s[1]&&(this.console="true"===s[1])}).bind(this)),"dashboards"===a?this.windowSizeChange.previewDashboardChangeOnResize(window.innerWidth,t.fileid,t.filename):"REPORTS"===a?(t.section="REPORTS",this.getParameter(t,"")):"ADHOC"===a&&("PREVIEW"===t.tpr?(this.adhocData.setEditOrCreateAdhoc({id:t.fileid,owner:t.owner,name:t.filename,type:"report",edit:!0}),this.router.navigate(["/Documents/adhoc"])):(this.outputType=t.extra,t.section="ADHOC",this.getParameter(t,"")))}else{localStorage.clear(),sessionStorage.clear(),localStorage.setItem("emd","true"),sessionStorage.setItem("FID","true");const e=this.activate.snapshot.params.credential.split("&"),t={};t.keyInfo=encodeURIComponent(this.activate.snapshot.params.byToken);let a="";i.forEach(e,(function(e){const s=e.split("__");"a_u"===s[0]&&""!==s[1]&&(t.userName=s[1]),"a_p"===s[0]&&""!==s[1]&&(t.password=s[1]),"a_t"===s[0]&&""!==s[1]&&(t.token=s[1]),"a_d"===s[0]&&""!==s[1]&&(t.deptCode=s[1]),"a_ex"===s[0]&&""!==s[1]&&(this.outputType=s[1]),"a_af"===s[0]&&""!==s[1]&&sessionStorage.setItem("af",s[1]),"a_tpr"===s[0]&&""!==s[1]&&(t.tpr=s[1],a=s[1])}).bind(this)),t.rm_pm="","noparam"!==this.activate.snapshot.params.parameter&&(t.rm_pm=this.activate.snapshot.params.parameter),localStorage.setItem("em-tt-k",t.token),localStorage.setItem("em-un-k",t.userName),this.httpClient.post(this.cu.geturl()+"eAuth",t).pipe(Object(h.a)(this.ngUnsubscribe)).subscribe(e=>{if(null==e||null==e)localStorage.clear(),sessionStorage.clear();else{const t={};i.forEach(e,function(e){Object.assign(t,e)});const s=t.hasOwnProperty("rm_pm")&&"null"!==t.rm_pm?t.rm_pm:"noparam"!==this.activate.snapshot.params.parameter?this.activate.snapshot.params.parameter:"";this.setLocal.setSessionStorage(e),"DASHBOARD"===t.section?"ipynb"===t.fType?this.router.navigate(["nb",t.fileid,t.filename]):("noparam"!==this.activate.snapshot.params.parameter&&sessionStorage.setItem("parameter",this.activate.snapshot.params.parameter),this.windowSizeChange.previewDashboardChangeOnResize(window.innerWidth,t.fileid,t.filename)):"REPORTS"===t.section?this.getParameter(t,s):"ADHOC"===t.section&&("PREVIEW"===a?(this.adhocData.setEditOrCreateAdhoc({id:t.fileid,owner:t.owner,name:t.filename,type:t.fType,edit:!0}),this.router.navigate(["/Documents/adhoc"])):(t.section="ADHOC",this.getParameter(t,s)))}},e=>{localStorage.clear(),sessionStorage.clear()})}}getParameter(e,t){const a=""===t?this.activate.snapshot.params.parameter.split("&"):t.split("&");this.reportParam={},"noparam"!==this.activate.snapshot.params.parameter?i.forEach(a,(function(t,s){const r=t.split("___");this.reportParam[r[0]]="ADHOC"===e.section&&"ReportTitle"!==r[0]?r[1].split(","):r[1],s===a.length-1&&("gbr"!=e.fType?this.addReportRequest(e):this.runReportBursting(e))}).bind(this)):this.addReportRequest(e)}addReportRequest(e){const t={};t.fileId=e.fileid,t.frequency="rightNow",t.groupName=e.filename,t.no_of_try_runReport=1,t.output_format=this.outputType,t.output_name=e.filename,t.output_path="/Output/Temp/",t.parameterObject=this.reportParam,t.parameterObject.__AIS_USERNAME=JSON.parse(this.getdataservice.getLocalStorageVals()).userName,t.parameterObject.__AIS_ROLES=JSON.parse(this.getdataservice.getLocalStorageVals()).roles,t.requestFor="REPORTS"===e.section?"ReportRun":"ROFEXECUTION",t.timezone="SYSTEM",t.try_frequency_runReport="00:05:00",t.owner=e.owner,this.setdataService.addrequestdata(t).pipe(Object(h.a)(this.ngUnsubscribe)).subscribe(e=>{this.showOutputOfReport(e,this.outputType)},e=>{})}showOutputOfReport(e,t){const a=JSON.parse(this.getdataservice.getLocalStorageVals());let s="";if(s=void 0===e.requestId?e.id:e.requestId,"rptdocument"===t||"phtml"===t||"prptdocument"===t)this.getdataservice.getSecuredResult("true",JSON.stringify({requestId:s,owner:a.userName,userName:a.userName,rk:1e3*Math.random()})).subscribe(e=>{let s="";s="internal"===this.activate.snapshot.params.embedType?localStorage.getItem("auth-token"):sessionStorage.getItem("auth-token");const r={q:e.result,d:"f",e:"t","X-XSRFTOKEN":s,token:a.token,userName:a.userName,owner:a.owner,dc:a.deptCode,vdc:a.vdeptCode};if("rptdocument"===t){const e=window.open(["jsp/AIbirtviewer.jsp",$.param(r)].join("?"),"_self");null!==e&&e.focus()}else if("phtml"===t){r.p="f",delete r.d;const e=window.open(["jsp/AIjasperviewer.jsp",$.param(r)].join("?"),"_self");null!==e&&e.focus()}else if("prptdocument"===t){r.p="f",delete r.d;const e=window.open(["jsp/AIpentahoviewer.jsp",$.param(r)].join("?"),"_self");null!==e&&e.focus()}},e=>{});else{let a;"ALERTSEXECUTION"!==e.requestFor&&("pdf"!==t&&"html"!==t?a=window.open():this.pollRequestForStatus(s,0,a),null!=a&&(a.focus(),this.pollRequestForStatus(s,0,a)))}}pollRequestForStatus(e,t,a){const s=JSON.parse(this.getdataservice.getLocalStorageVals());this.getdataservice.getRequestById(e).subscribe(r=>{"COMPLETED"===r.status&&r.hasOwnProperty("output_id")&&r.output_id>0?this.getdataservice.getSecuredResult("true",JSON.stringify({id:r.output_id,owner:s.userName,userName:s.userName,rk:1e3*Math.random()})).subscribe(e=>{const t=/msie\s|trident\/|edge\//i.test(window.navigator.userAgent),o={q:e.result,e:"t","X-XSRFTOKEN":sessionStorage.getItem("auth-token"),token:s.token,userName:s.userName,owner:s.owner,dc:s.deptCode,vdc:s.vdeptCode};"pdf"===r.output_format||"html"===r.output_format?this.setdataService.downloadRequest("DownloadFile","_self",e,"t","inline",null):(o.actionType="attachment",!0===t?this.getdataservice.downloadReportOutput(o).subscribe(e=>{const t=e.headers(),a=t["content-disposition"].substring(t["content-disposition"].indexOf("=")+2,t["content-disposition"].lastIndexOf('"')),s=t["content-type"];document.createElement("a");try{const t=new Blob([e],{type:s});window.URL.createObjectURL(t),window.navigator.msSaveOrOpenBlob(t,a)}catch(r){this.alert.alert(r,"error")}},e=>{}):(this.alert.alert("request_wait","info"),this.setdataService.downloadRequest("DownloadFile","_self",e,"t","attachment",null),setTimeout(()=>{a.close()},1500)))},e=>{}):t<12e5&&(t+=5e3,setTimeout(()=>{this.pollRequestForStatus(e,t,a)},5e3))},e=>{})}runReportBursting(e){const t=JSON.parse(this.getdataservice.getLocalStorageVals());this.alert.showSpinner(),this.getdataservice.getSecuredResult("true",JSON.stringify({id:e.fileid,userName:t.userName,owner:t.owner,rk:1e3*Math.random()})).pipe(Object(h.a)(this.ngUnsubscribe)).subscribe(e=>{this.alert.hideSpinner();const a={q:e.result,e:"t","X-XSRFTOKEN":JSON.parse(this.getdataservice.getLocalStorageVals())["auth-token"],token:t.token,userName:t.userName,owner:t.owner,dc:t.deptCode,vdc:t.vdeptCode,gaivid:this.reportParam.hasOwnProperty("gaivid")?this.reportParam.gaivid:1,gk:this.reportParam.gk};if((this.reportParam.hasOwnProperty("__AIS_USERNAME")||this.reportParam.hasOwnProperty("gaivid")&&parseInt(this.reportParam.gaivid)/9==0)&&(a.gaivid=9*Math.floor(1e3*Math.random()),a.gk="getOwner",a.__AIS_USERNAME=""),(this.reportParam.hasOwnProperty("__AIS_ROLES")||this.reportParam.hasOwnProperty("gaivid")&&parseInt(this.reportParam.gaivid)/22==0)&&(a.gaivid=22*Math.floor(1e3*Math.random()),a.gk="getRoles",a.__AIS_ROLES=""),"rptdocument"===this.outputType){const e=window.open(["jsp/AIbirtviewer.jsp",$.param(a)].join("?"),"_self");null!==e&&e.focus()}else if("phtml"===this.outputType){a.p="t",delete a.d;const e=window.open(["jsp/AIjasperviewer.jsp",$.param(a)].join("?"),"_self");null!==e&&e.focus()}else if("prptdocument"===this.outputType){a.p="t",delete a.d;const e=window.open(["jsp/AIpentahoviewer.jsp",$.param(a)].join("?"),"_self");null!==e&&e.focus()}else{const t="DownloadFile?gk="+a.gk+(a.hasOwnProperty("__AIS_USERNAME")?"&__AIS_USERNAME=":"")+(a.hasOwnProperty("__AIS_ROLES")?"&__AIS_ROLES=":"");this.outputType.indexOf("pdf")>-1||this.outputType.indexOf("html"),this.setdataService.downloadRequest(t,"_self",e,"t","inline",a.gaivid)}},e=>{this.alert.hideSpinner(),this.alert.alert("alert_Error","error")})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}var _=a("iInd"),w=a("IheW"),S=s["\u0275crt"]({encapsulation:0,styles:[["@keyframes ais_anim_fadeIn{from{opacity:0}to{opacity:1}}.ais_animdiv_fadeIn[_ngcontent-%COMP%]{animation:3s infinite ais_anim_fadeIn}.embed_filediv_wrap[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;justify-content:center;align-items:center}"]],data:{}});function v(e){return s["\u0275vid"](0,[],null,null)}function O(e){return s["\u0275vid"](0,[(e()(),s["\u0275eld"](0,0,null,null,1,"app-embed-file",[],null,null,null,v,S)),s["\u0275did"](1,245760,null,0,f,[_.p,_.a,w.c,n.a,p.a,l.a,c.a,d.a,m.a,g.a],null,null)],function(e,t){e(t,1,0)},null)}var R=s["\u0275ccf"]("app-embed-file",f,O,{},{},[]),b=a("SVse");const y={category:"External_Embed"};class I{}a.d(t,"EmbedFileModuleNgFactory",function(){return E});var E=s["\u0275cmf"](r,[],function(e){return s["\u0275mod"]([s["\u0275mpd"](512,s.ComponentFactoryResolver,s["\u0275CodegenComponentFactoryResolver"],[[8,[o.a,R]],[3,s.ComponentFactoryResolver],s.NgModuleRef]),s["\u0275mpd"](4608,b.NgLocalization,b.NgLocaleLocalization,[s.LOCALE_ID,[2,b["\u0275angular_packages_common_common_a"]]]),s["\u0275mpd"](1073742336,b.CommonModule,b.CommonModule,[]),s["\u0275mpd"](1073742336,_.r,_.r,[[2,_.x],[2,_.p]]),s["\u0275mpd"](1073742336,I,I,[]),s["\u0275mpd"](1073742336,r,r,[]),s["\u0275mpd"](1024,_.m,function(){return[[{path:":embedType/:byToken/:credential/:parameter",component:f,data:y}]]},[])])})}}]);